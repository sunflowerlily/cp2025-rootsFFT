# 超新星数据拟合哈勃常数

## 项目背景

哈勃定律是宇宙学中的一个基本规律，描述了星系的后退速度与其距离之间的线性关系。这一关系由美国天文学家埃德温·哈勃（Edwin Hubble）于1929年首次发现。哈勃定律可以表示为：

$$v = H_0 \times d$$

其中：
- $v$ 是星系的后退速度（通常以km/s为单位）
- $d$ 是星系的距离（通常以Mpc为单位，1 Mpc = 3.26×10^6光年）
- $H_0$ 是哈勃常数，表示宇宙膨胀的速率（通常以km/s/Mpc为单位）

哈勃常数的精确测量对于理解宇宙的年龄、大小和演化至关重要。在本项目中，我们将使用Ia型超新星的观测数据来拟合哈勃常数。Ia型超新星是一种标准烛光（standardizable candles），其绝对亮度几乎相同，因此可以通过测量其视亮度来确定其距离。

2010年，Amanullah等人在论文《Spectra and Hubble Space Telescope Light Curves of Six Type Ia Supernovae at 0.511 < z < 1.12 and the Union2 Compilation》中发布了一个包含约500个Ia型超新星的数据集。这个数据集被广泛用于宇宙学参数的测量。在本项目中，我们将使用一个简化版的数据集来拟合哈勃常数。

## 项目任务

在本项目中，你需要完成以下任务：

1. **数据加载与预处理**：
   - 实现`load_supernova_data`函数，从文件中加载超新星数据，包括红移、距离模数和误差。
   - 数据文件格式为CSV，包含三列：红移z、距离模数μ、距离模数误差σ_μ。

2. **哈勃常数拟合**：
   - 实现`hubble_fit`函数，使用最小二乘法拟合哈勃常数。
   - 考虑距离模数的误差，进行加权最小二乘拟合。
   - 返回拟合得到的哈勃常数及其误差。

3. **哈勃图绘制**：
   - 实现`plot_hubble_diagram`函数，绘制哈勃图（距离模数vs红移）。
   - 在图上显示数据点（带误差棒）和最佳拟合曲线。
   - 在图上标注拟合得到的哈勃常数值。

## 数据说明

提供的数据文件`supernova_data.txt`包含以下列：

- 第一列：红移z
- 第二列：距离模数μ（单位：等）
- 第三列：距离模数误差σ_μ（单位：等）

其中，距离模数μ与距离d（单位：10pc）的关系为：

$$\mu = 5 \log_{10}(d) - 5$$

## 物理背景与拟合模型

### 红移与距离的关系

在宇宙学中，红移z与后退速度v（当v << c时）的关系为：

$$v = c \times z$$

其中c是光速（约为299792.458 km/s）。

对于较大的红移，需要考虑相对论效应，此时关系变为：

$$v = c \times \frac{(1+z)^2-1}{(1+z)^2+1}$$

但在本项目中，我们主要关注低红移区域（z < 0.2），此时可以使用线性近似。

### 距离模数与红移的关系

在宇宙学中，光度距离$d_L$与红移z的关系可以通过泰勒展开表示为（对于低红移）：

$$d_L = \frac{c}{H_0} \times z \times \left(1 + \frac{1}{2}(1-q_0)z\right)$$

其中$q_0$是减速参数。在本项目中，为了简化，我们将使用以下模型：

$$d_L = \frac{c}{H_0} \times z \times \left(1 + \frac{1}{2}(1-a_1)z\right)$$

其中$a_1$是一个拟合参数，对应于减速参数$q_0$。

将光度距离代入距离模数公式，并考虑到距离单位的转换（从Mpc到10pc），我们得到：

$$\mu = 5\log_{10}\left(\frac{c \times z}{H_0} \times \left(1 + \frac{1}{2}(1-a_1)z\right) \times 10^6 \times \frac{3.26}{10}\right)$$

简化后，我们得到：

$$\mu = 5\log_{10}\left(\frac{c \times z}{H_0} \times \left(1 + \frac{1}{2}(1-a_1)z\right)\right) + 25$$

其中，常数25来自于距离单位的转换。

### 拟合方法

在本项目中，我们将使用`scipy.optimize.curve_fit`函数或者`lmfit`模块进行加权最小二乘拟合。该函数通过最小化以下目标函数来确定最佳参数：

$$\chi^2 = \sum_{i} \frac{(\mu_i - \mu_{model}(z_i, H_0))^2}{\sigma_{\mu,i}^2}$$

其中：
- $\mu_i$是第i个超新星的观测距离模数
- $\mu_{model}(z_i, H_0)$是模型预测的距离模数
- $\sigma_{\mu,i}$是距离模数的测量误差

为了简化，我们可以使用以下模型进行拟合：

$$\mu = 5\log_{10}\left(\frac{c \times z}{H_0}\right) + 25$$

这相当于假设 $a_1 = 1$（或 $q_0 = 0$）。

通过对观测数据进行拟合，我们可以得到哈勃常数 $H_0$的估计值及其不确定度。

## 提交要求

1. 提交测试通过的`supernova_hubble_fitting_student.py`
2. 提交`实验报告.md`: 需包含方法描述、结果分析和讨论, 包含所有插值结果和图表